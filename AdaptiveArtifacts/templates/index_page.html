<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="layout.html" />

  <py:def function="spec_markup(specs, page_nr=0)">
      <ul py:if="specs">
      <py:for each="spec,subspecs,arts_count in specs">
              <li id="spec-${spec.get_id()}">
                  <div py:choose="">
                  <a py:when="selected_spec and spec.get_id() == selected_spec.get_id()" class="selected" href="${req.href.adaptiveartifacts(spec=spec.get_id(), page=page_nr)}">${spec_anchor_content_markup(spec, arts_count, len(subspecs))}</a>
                  <a py:otherwise="" href="${req.href.adaptiveartifacts(spec=spec.get_id(), page=page_nr)}">${spec_anchor_content_markup(spec, arts_count, len(subspecs))}</a>
                  <py:if test="subspecs">
                      ${spec_markup(subspecs)}
                  </py:if>
              </div>
          </li>
      </py:for>
      </ul>
  </py:def>

  <py:def function="spec_anchor_content_markup(spec, arts_count, subspecs_count)">
      ${spec.get_name()} <py:if test="arts_count>0 or subspecs_count>0"><small>(<py:if test="arts_count>0">${arts_count}</py:if>)</small></py:if>
  </py:def>

  <head><title></title></head>
  <body>
     <div id="content" class="asa-index">

         <div class="buttons" style="float:right;">
             <form method="get" action="${href.adaptiveartifacts('spec')}">
                 <input type="hidden" name="action" value="new" />
                 <input type="submit" value="New Spec" />
             </form>
             <form method="get" action="${href.adaptiveartifacts('artifact')}">
                 <input type="hidden" name="action" value="new" />
                 <input type="submit" value="New Artifact" />
             </form>
         </div>
        <h1>Adaptive Artifacts</h1>

        <div id="entry-points" class="tree">
            <h2>By Spec</h2>
            <div id="specs">
            ${spec_markup(specs)}
            </div>

            <h2>By Other Features</h2>
            <div id="others">
                <ul>
                    <li>
                        <py:choose test="">
                        <a py:when="selected_search == 'no_spec'" class="selected" href="${req.href.adaptiveartifacts(search='no_spec')}">Artifacts with no spec <small>(${len(artifacts_values)})</small></a>
                        <a py:otherwise="" href="${req.href.adaptiveartifacts(search='no_spec')}">Artifacts with no spec <small>(${len(artifacts_values)})</small></a>
                        </py:choose>
                    </li>
                </ul>
            </div>
            <br/><br/>
        </div>

        <div id="artifacts">
            <py:choose test="">
              <py:when test="not selected_spec and not selected_search">
                  Please select a Spec.
              </py:when>
              <py:otherwise>

                <py:if test="selected_spec and not selected_search">
                    <h2>${selected_spec.get_name()}</h2> <span class="spec-options"><a href="${req.href.adaptiveartifacts('spec', selected_spec.get_id(), action='view')}">[details]</a><a href="${req.href.adaptiveartifacts('spec', selected_spec.get_id(), action='edit')}">[edit]</a></span>
                    <div class="spec-details">
                    ${len(spec_columns)} Attributes;
                    <!-- X Subspecs; -->
                    ${len(artifacts_values)} Adaptive Artifacts.
                    </div>
                </py:if>
                <py:if test="selected_search and selected_search=='no_spec'">
                    <h2>Artifacts with no Spec</h2>
                    <div class="spec-details">
                    ${len(artifacts_values)} Adaptive Artifacts.
                    </div>
                </py:if>

                <!--
                <div class="paging">
                    <span><span class="current">1</span></span>
                    <span><a href="/my-trac-environment/search?asa=on&amp;changeset=on&amp;milestone=on&amp;ticket=on&amp;wiki=on&amp;q=trac&amp;page=2&amp;noquickjump=1" title="page 2">2</a></span>
                    <span class="next"><a href="/my-trac-environment/search?asa=on&amp;changeset=on&amp;milestone=on&amp;ticket=on&amp;wiki=on&amp;q=trac&amp;page=2&amp;noquickjump=1" title="Next Page">→</a></span>
                </div>
                -->
                <h3>Adaptive Artifacts</h3>

                <table class="listing">
                    <thead>
                        <tr>
                            <py:for each="column in spec_columns"><th title="'${column}' attribute, defined by the '${selected_spec.get_name()}' Spec.">${column}</th></py:for>
                            <py:for each="column in arti_columns"><th style="font-style:italic;">${column}</th></py:for>
                            <th class="artifact-pages">Pages</th>
                            <th class="artifact-options">Options</th>
                        </tr>
                    </thead>
                    <py:for each="artifact,values in artifacts_values">
                        <tr>
                            <py:for each="value in values">
                                <td>${value}</td>
                            </py:for>
                            <td class="artifact-pages">
                                <py:choose test="">
                                  <py:when test="artifacts_pages_count[artifact]>0">
                                      <a href="${req.href.adaptiveartifacts('pages', artifact=artifact.get_id())}">${artifacts_pages_count[artifact]}</a>
                                  </py:when>
                                  <py:otherwise>
                                      ${artifacts_pages_count[artifact]}
                                  </py:otherwise>
                                </py:choose>
                            </td>
                            <td class="artifact-options"><a href="${req.href.adaptiveartifacts('artifact', artifact.get_id(), action='view')}">[view]</a> <a href="${req.href.adaptiveartifacts('artifact', artifact.get_id(), action='edit')}">[edit]</a></td>
                        </tr>
                    </py:for>
                </table>

                <!--
                <div class="paging">
                    <span><span class="current">1</span></span>
                    <span><a href="/my-trac-environment/search?asa=on&amp;changeset=on&amp;milestone=on&amp;ticket=on&amp;wiki=on&amp;q=trac&amp;page=2&amp;noquickjump=1" title="page 2">2</a></span>
                    <span class="next"><a href="/my-trac-environment/search?asa=on&amp;changeset=on&amp;milestone=on&amp;ticket=on&amp;wiki=on&amp;q=trac&amp;page=2&amp;noquickjump=1" title="Next Page">→</a></span>
                </div>
                -->
                <br/>
              </py:otherwise>
            </py:choose>
        </div>

        <br/><br/>

     </div>
  </body>
</html>
